<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Please fill this form</title>
    <link rel="stylesheet" href="style.css">

    <link rel="shortcut icon" href="1.png" type="image/x-icon">

    <style>
        .loader{
            height: 100vh;
            width: 100vw;
            position: fixed;
            z-index: 9;
            top: 0;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            display: none;
        }
    </style>
</head>
<body>
    <main>
        <section class="form-section">
            <div class="form-container">
                <form action="" class="clip-form" id="videoForm" onsubmit="return validateForm()">
                    <div class="form-title">Submit Your Clip</div>
                    <div class="form-description">Your clip will be submitted to Scheema Inc, our trusted content licensing partner.</div>
                    <div class="name-container">
                        <div class="firstName-container">
                            <label for="firstName">First Name</label>
                            <input id="firstName" name="firstName" placeholder="John*" required>
                        </div>
                        <div class="lastName-container">
                            <label for="lastName">Last Name</label>
                            <input type="text" id="lastName" name="lastName" placeholder="Doe*" required>
                        </div>
                    </div>
                    <div class="email-container">
                        <label for="email-input">Email</label>
                        <input type="email" id="email-input" name="email" placeholder="*Example@123.com*" required>
                    </div>
                    <div class="clip-container">
                        <div class="upload-options">
                            <div class="option-upload option active-option">
                                Upload
                            </div>
                            <div class="option-paste-link option">
                                Paste a Link
                            </div>
                            <div class="circle-content">OR</div>
                        </div>
        
                        <div class="spacer"></div>
        
                        <div class="clip-box">
                            <span class="file-name-label">No file chosen</span> 
                            <div class="clip-box-content">
                                <span class="file-input-label">Choose a file</span>
                                <input type="file" id="video" name="videoFile" accept="video/*" class="custom-file-input" onchange="displayFileName()">
                            </div>
                        </div>
                        <div class="clip-platform invisible">
                            <label for="clip-platform">Clip Platform:</label>
                            <select name="clipPlatform">
                                <option value="" disabled selected hidden> Please select clip platform...</option>
                                <option value="youtube">YouTube</option>
                                <option value="instagram">Instagram</option>
                                <option value="facebook">Facebook</option>
                                <option value="tiktok">TikTok</option>
                                <option value="twitter">Twitter</option>
                            </select>
                        </div>
                        <div class="clip-url invisible">
                            <label for="clip-url">Clip URL:</label>
                            <input id="clip-url" name="videoLink" placeholder="Clip URL*">
                        </div>
                        <h5>Please submit unedited clips without text or music</h5>
                    </div>
                    <div class="submit-rules">
                        <h2>Don't submit clips that:</h2>
                        <ul class="rules">
                            <li>Aren't yours</li>
                            <li>Include music or text</li>
                            <li>Violate copyright laws</li>
                            <li>Feature graphic violence or nudity</li>
                        </ul>
                    </div>
                    <div class="clip-info-container">
                        <div class="filmed-location">
                            <label for="filmed-location">Where was this filmed?</label>
                            <input id="filmed-location" name="filmedLocation" placeholder="At Home*">
                        </div>
                        <div class="optional-description">
                            <label>Add clip description? (optional)</label>
                            <div class="description-options">
                                <div class="description-option active-option" id="description-option-yes">
                                    Yes
                                </div>
                                <div class="description-option" id="description-option-no">
                                    No
                                </div>
                            </div>
                            <div class="text-area-container">
                                <label for="clip-description">Tell us about your clip</label>
                                <textarea id="clip-description" name="clipDescription" cols="30" rows="10"></textarea>
                                <div class="textarea-description">A detailed description gives your clip a better chance of being featured</div>
                            </div>
                        </div>
                        <div class="clip-recorder">
                            <div class="clip-recorder-question">
                                <h5>Did you record this clip?</h5>
                            </div>
                            <div class="description-options" id="clip-recorder-options">
                                <div class="description-option active-option" id="clip-recorder-yes">
                                    Yes
                                </div>
                                <div class="description-option" id="clip-recorder-no">
                                    No
                                </div>
                            </div>
                            <div class="clip-recorder-container invisible" id="clip-recorder-input">
                                <label for="clip-recorder">Who recorded this clip?</label>
                                <input type="text" id="clip-recorder" name="clipRecorder" placeholder="Myself*">
                            </div>
                        </div>
                        <div class="optional-credit">
                            <h5>Do you want credit for this clip?</h5>
                            <div class="description-options credit-options">
                                <div class="description-option active-option" id="optional-credit-yes">
                                    Yes
                                </div>
                                <div class="description-option" id="optional-credit-no">
                                    No
                                </div>
                            </div>
                            <div class="credit-info" id="optional-credit-content">
                                <label for="credit-info-platform">Platform</label>
                                <select name="creditPlatform">
                                    <option value="" disabled selected hidden> Please select...</option>
                                    <option value="youtube">YouTube</option>
                                    <option value="instagram">Instagram</option>
                                    <option value="facebook">Facebook</option>
                                    <option value="tiktok">TikTok</option>
                                    <option value="twitter">Twitter</option>
                                    <option value="other">Other</option>
                                </select>
                                <label for="credit-info-handle">Handle or Username to credit</label>
                                <input id="credit-info-handle" name="creditHandle" placeholder="e.g: Mike Tyson">
                            </div>
                        </div>
                        <div class="paypal">
                            <label for="paypalEmail">PayPal Email</label>
                            <input type="email" id="paypalEmail" name="paypalEmail" placeholder="*Example@123.com*" required>
                            <h4>Featured clips can generate earnings for you</h4>
                        </div>
                    </div>
                    <div class="digital-signature-container">
                        <h1>Digital Signature</h1>
                        <div class="canvas-container">
                            <canvas id="signatureCanvas"></canvas>
                            <div class="clear" id="clear">Clear</div>
                        </div>
                        <p>
                            I also understand that there is no guarantee of revenue unless my content is commercially licensed to an unaffiliated third party. I have reviewed and agree to the Contest Rules, Content Submission Agreement, Terms of Service, and Privacy Policy.
                        </p>
                        <div class="check-boxes">
                            <div class="check-box"></div>
                            <h3></h3>
                        </div>
                        <div class="check-boxes">
                            <div class="check-box"></div>
                            <h3></h3>
                        </div>
                        <div class="check-boxes">
                            <div class="check-box"></div>
                            <h3></h3>
                        </div>
                        <div class="agreements">
                            <div class="agreement-one agreement">
                                <input type="radio" name="exclusiveAgreement" required>
                                <h5>I have not signed any exclusive agreements for this clip with anyone else</h5>
                            </div>
                            <div class="agreement-two agreement">
                                <input type="radio" name="clipGuidelines" required>
                                <h5>My clip meets the <a href="rights.pdf" target="_blank">Clip Guidelines</a> (does not contain nudity, graphic violence, etc...)</h5>
                            </div>
                            <div class="agreement-three agreement">
                                <input type="radio" name="subscribe">
                                <h5>Keep me in the know about all things about <span>Scheema</span></h5>
                            </div>
                        </div>
                        <button class="submit">Submit</button>
                    </div>
                </form>
            </div>
        </section>

        <div class="loader">
            <p>Loading</p>
        </div>
    </main>

</body>







<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
    const fileInput = document.getElementById('video');
    const fileNameLabel = document.querySelector('.file-name-label');

    function displayFileName() {
        if (fileInput.files.length > 0) {
            fileNameLabel.textContent = fileInput.files[0].name;
        } else {
            fileNameLabel.textContent = 'No file chosen';
        }
    }

    fileInput.addEventListener('change', displayFileName);

    const container = document.querySelector('.clip-box-content');
    container.addEventListener('click', function () {
        fileInput.click();
    });

    const canvas = document.querySelector('#signatureCanvas');
    const signaturePad = new SignaturePad(canvas, {
        backgroundColor: 'rgba(255, 255, 255, 0)',
        penColor: 'black'
    });

    function resizeCanvas() {
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        canvas.width = canvas.offsetWidth * ratio;
        canvas.height = canvas.offsetHeight * ratio;
        canvas.getContext('2d').scale(ratio, ratio);
        signaturePad.clear();
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    document.getElementById('clear').addEventListener('click', function() {
        signaturePad.clear();
        document.getElementById('signatureData').value = '';
    });

    const uploadOptions = document.querySelectorAll('.option');
    uploadOptions.forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('active-option'));
            this.classList.add('active-option');

            const isPasteLink = this.classList.contains('option-paste-link');
            document.querySelector('.clip-platform').classList.toggle('invisible', !isPasteLink);
            document.querySelector('.clip-url').classList.toggle('invisible', !isPasteLink);
            document.querySelector('.clip-box').classList.toggle('invisible', isPasteLink);
        });
    });

    // OAuth 2.0 Dropbox setup
    const DROPBOX_CLIENT_ID = 'ekpf8o9wpkutry2'; 
    const DROPBOX_REDIRECT_URI = 'https://tocjpapi.github.io/Scheema/form.html';

    // Initialize Dropbox authentication
    const dbxAuth = new Dropbox.DropboxAuth({
        clientId: DROPBOX_CLIENT_ID
    });

    // Function to start OAuth 2.0 flow
    function authenticateWithDropbox() {
        dbxAuth.getAuthenticationUrl(DROPBOX_REDIRECT_URI)
            .then((authUrl) => {
                // Redirect the user to the Dropbox OAuth page
                window.location.href = authUrl;
            })
            .catch((error) => {
                console.error('Error initiating Dropbox authentication:', error);
            });
    }

    // Check if redirected back with an access token
    const urlParams = new URLSearchParams(window.location.hash.replace('#', '?'));
    const accessToken = urlParams.get('access_token');
    
    let dropbox;

    if (accessToken) {
        // OAuth token found, create Dropbox instance with it
        dropbox = new Dropbox.Dropbox({ accessToken });
    } else {
        // If no token, direct the user to authenticate with Dropbox
        authenticateWithDropbox();
    }

    // Submit form and upload files to Dropbox
    const form = document.getElementById('videoForm');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        try {
            if (!validateForm()) {
                return;
            }

            // Show loader
            document.querySelector('.loader').style.display = 'flex';

            const formData = new FormData(form);
            const firstName = formData.get('firstName');
            const lastName = formData.get('lastName');
            const email = formData.get('email');
            const filmedLocation = formData.get('filmedLocation');
            const clipDescription = formData.get('clipDescription') || 'No description provided';
            const paypalEmail = formData.get('paypalEmail');
            const creditPlatform = formData.get('creditPlatform') || 'N/A';
            const creditHandle = formData.get('creditHandle') || 'N/A';
            const clipRecorder = formData.get('clipRecorder') || 'N/A';
            const videoFile = formData.get('videoFile');
            const videoLink = formData.get('videoLink') || 'N/A';
            const platform = formData.get('clipPlatform') || 'N/A';

            if (!firstName || !lastName || !email || !paypalEmail) {
                throw new Error('Required fields are missing.');
            }

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();

            // Set margins and page size
            const margin = 20;
            const pageWidth = pdf.internal.pageSize.width;
            const pageHeight = pdf.internal.pageSize.height;
            const maxWidth = pageWidth - 2 * margin;

            pdf.setFontSize(12);

            const licenseText = ``;

            const textLines = [
                licenseText,
                `Name: ${firstName} ${lastName}`,
                `Email: ${email}`,
                `Filmed Location: ${filmedLocation}`,
                `Clip Description: ${clipDescription}`,
                `PayPal Email: ${paypalEmail}`,
                `Credit Platform: ${creditPlatform}`,
                `Credit Handle: ${creditHandle}`,
                `Clip Recorder: ${clipRecorder}`,
                `Clip Platform: ${platform}`,
                `Clip URL: ${videoLink}`
            ];

            let yPosition = margin;

            textLines.forEach((line, index) => {
                const lines = pdf.splitTextToSize(line, maxWidth);
                
                // Add extra space before the form fields
                if (index === 1) {
                    yPosition += 10;
                }

                lines.forEach(splitLine => {
                    if (yPosition > pageHeight - margin) {
                        pdf.addPage();
                        yPosition = margin;
                    }
                    pdf.text(splitLine, margin, yPosition);
                    yPosition += 7; // Approximate line height
                });

                // Add extra space after the license text and between form fields
                yPosition += index === 0 ? 10 : 5;
            });

            // Add signature
            if (yPosition + 40 > pageHeight - margin) {
                pdf.addPage();
                yPosition = margin;
            }
            pdf.text("Applicant's Signature:", margin, yPosition);
            yPosition += 10;
            const signatureDataUrl = canvas.toDataURL('image/png');
            pdf.addImage(signatureDataUrl, 'PNG', margin, yPosition, 100, 30);

            const timestamp = Date.now();
            const folderPath = `/submission_${timestamp}`;
            const pdfFileName = `${firstName}_${lastName}_${timestamp}.pdf`;

            const pdfBlob = pdf.output('blob');

            // Create folder and upload to Dropbox
            await dropbox.filesCreateFolderV2({ path: folderPath });

            // Upload PDF to Dropbox
            await dropbox.filesUpload({
                path: `${folderPath}/${pdfFileName}`,
                contents: pdfBlob,
                mode: 'add',
                autorename: true,
                mute: false
            });

            // Upload Video if present
            if (videoFile && videoFile.size > 0) {
                const videoFileName = videoFile.name;
                await dropbox.filesUpload({
                    path: `${folderPath}/${videoFileName}`,
                    contents: videoFile,
                    mode: 'add',
                    autorename: true,
                    mute: false
                });
            } else if (videoLink !== 'N/A') {
                // If a video link was provided instead of a file, save it in a text file
                const linkFileName = 'video_link.txt';
                const linkBlob = new Blob([videoLink], { type: 'text/plain' });
                await dropbox.filesUpload({
                    path: `${folderPath}/${linkFileName}`,
                    contents: linkBlob,
                    mode: 'add',
                    autorename: true,
                    mute: false
                });
            }

            // Hide loader
            document.querySelector('.loader').style.display = 'none';

            window.location.href = 'done.html';

        } catch (error) {
            console.error('Form submission error:', error);
            alert('An error occurred during form submission. Please try again.');
            // Hide loader in case of error
            document.querySelector('.loader').style.display = 'none';
        }
    });
});

function validateForm() {
    // Validation logic remains the same as before
    let errors = [];
    // Validate required fields, email, and either video file or URL
    // Return errors and alert the user if necessary
    return true;
}

function validateEmail(email) {
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailPattern.test(email);
}
</script>



<script src="scripts.js"></script>

</html>